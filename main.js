// ========================================
// SCRIPTS DA HOME
// ========================================

// Classe para representar um Pokemon na home
class PokemonCard {
	constructor(name, url) {
		this.name = name;
		this.url = url;
		this.id = null;
		this.sprite = null;
		this.types = [];
	}

	// M√©todo para buscar detalhes do Pokemon para o card
	// procura o id(numero da pokedex), sprite(de frente) e tipos
	async fetchDetails() {
		try {
			const response = await fetch(this.url);
			if (!response.ok) {
				throw new Error(`Erro HTTP: ${response.status}`);
			}

			const data = await response.json();

			// Extrair apenas as informa√ß√µes necess√°rias para o card
			this.id = data.id;
			this.sprite = data.sprites.front_default;
			this.types = data.types.map((typeInfo) => typeInfo.type.name);

			console.log(`‚úÖ Pokemon ${this.name} carregado:`, {
				id: this.id,
				name: this.name,
				sprite: this.sprite,
				types: this.types,
			});

			return this;
		} catch (error) {
			console.error(`‚ùå Erro ao buscar detalhes do ${this.name}:`, error);
			throw error;
		}
	}

	// Retorna dados formatados para exibi√ß√£o no card
	getCardData() {
		return {
			id: this.id,
			pokedexnumber: this.id ? this.id.toString().padStart(3, "0") : "???",
			name: this.name.charAt(0).toUpperCase() + this.name.slice(1),
			sprite: this.sprite,
			types: this.types.map(
				(type) => type.charAt(0).toUpperCase() + type.slice(1)
			),
		};
	}

	// M√©todo para renderizar o card na home (simula√ß√£o para front-end)
	renderCard() {
		const cardData = this.getCardData();

		// Simular inser√ß√£o de HTML do card
		console.log(`üé® RENDERIZANDO CARD - Pokemon #${cardData.pokedexnumber}:`);
		console.log(`
		<!-- Card do ${cardData.name} -->
		<div class="pokemon-card" data-pokemon-id="${cardData.id}">
			<div class="pokemon-number">#${cardData.pokedexnumber}</div>
			<img src="${cardData.sprite}" alt="${cardData.name}" class="pokemon-sprite">
			<h3 class="pokemon-name">${cardData.name}</h3>
			<div class="pokemon-types">
				${cardData.types
					.map(
						(type) => `<span class="type-badge type-${type}">${type}</span>`
					)
					.join("")}
			</div>
		</div>
		`);

		// TO DO: Front-end deve implementar:
		// const cardContainer = document.querySelector('.pokemon-grid');
		// cardContainer.innerHTML += [HTML do card acima];

		return cardData;
	}
}

// Classe para gerenciar a Home
class HomeManager {
	constructor() {
		this.pokemons = [];
		this.currentOffset = 0;
		this.limit = 32;
		this.isLoading = false;
		this.hasMore = true;
		this.baseUrl = "https://pokeapi.co/api/v2/pokemon";
	}

	// Fetch gen√©rico para a API
	async makeApiRequest(url) {
		try {
			console.log(`üåê Fazendo requisi√ß√£o para: ${url}`);

			const response = await fetch(url);
			if (!response.ok) {
				throw new Error(`Erro HTTP: ${response.status}`);
			}

			const data = await response.json();
			console.log(`‚úÖ Resposta da API recebida com sucesso`);

			return data;
		} catch (error) {
			console.error("‚ùå Erro na requisi√ß√£o da API:", error);
			throw error;
		}
	}

	// Fetch espec√≠fico para carregar pokemons da home
	async fetchPokemonsForHome() {
		if (this.isLoading) {
			console.log("‚è≥ Carregamento j√° em andamento, aguarde...");

			// TO DO: Front-end deve implementar:
			// const loadButton = document.querySelector('.load-more-btn');
			// loadButton.disabled = true;
			// loadButton.textContent = 'Carregando...';

			return [];
		}

		try {
			this.isLoading = true;
			console.log(
				`üîÑ Carregando pokemons para home - offset: ${this.currentOffset}`
			);

			// Exibir estado de carregamento
			console.log(`üìä ATUALIZANDO UI - Estado de carregamento:`);
			console.log(`
			<!-- Mostrar loading state -->
			<div class="loading-indicator">
				<span>Carregando pok√©mons...</span>
				<div class="spinner"></div>
			</div>
			`);

			// TO DO: Front-end deve implementar:
			// const loadingIndicator = document.querySelector('.loading-indicator');
			// loadingIndicator.style.display = 'block';

			const url = `${this.baseUrl}?offset=${this.currentOffset}&limit=${this.limit}`;
			const listData = await this.makeApiRequest(url);

			this.hasMore = this.currentOffset + this.limit < listData.count;

			// Buscar detalhes de cada pokemon para mostrar os cards
			const pokemonPromises = listData.results.map(async (item) => {
				const pokemonCard = new PokemonCard(item.name, item.url);
				await pokemonCard.fetchDetails();
				return pokemonCard;
			});

			const newPokemons = await Promise.all(pokemonPromises);

			// Adicionar os novos pokemons √† lista
			this.pokemons.push(...newPokemons);
			this.currentOffset += this.limit;

			console.log(`üéâ CARREGAMENTO CONCLU√çDO:`);
			console.log(`üìà ${newPokemons.length} novos pokemons carregados`);
			console.log(`üìä Total de pokemons: ${this.pokemons.length}`);
			console.log(`üîÑ Pr√≥ximo offset: ${this.currentOffset}`);
			console.log(`‚û°Ô∏è H√° mais pokemons: ${this.hasMore ? "Sim" : "N√£o"}`);

			// Renderizar todos os novos cards
			this.renderNewCards(newPokemons);

			// Atualizar estado do bot√£o "Carregar Mais"
			this.updateLoadMoreButton();

			// Esconder loading
			console.log(`üé® REMOVENDO LOADING:`);
			console.log(`<!-- Remover loading indicator -->`);

			// TO DO: Front-end deve implementar:
			// const loadingIndicator = document.querySelector('.loading-indicator');
			// loadingIndicator.style.display = 'none';

			return newPokemons;
		} catch (error) {
			console.error("‚ùå Erro ao carregar pokemons para home:", error);

			// Mostrar erro na UI
			console.log(`üö® EXIBINDO ERRO NA UI:`);
			console.log(`
			<div class="error-message">
				<span>‚ùå Erro ao carregar pok√©mons. Tente novamente.</span>
				<button onclick="homeManager.fetchPokemonsForHome()">Tentar Novamente</button>
			</div>
			`);

			// TO DO: Front-end deve implementar:
			// const errorContainer = document.querySelector('.error-container');
			// errorContainer.innerHTML = [HTML do erro acima];
			// errorContainer.style.display = 'block';

			throw error;
		} finally {
			this.isLoading = false;
		}
	}

	// M√©todo para renderizar novos cards na home
	renderNewCards(newPokemons) {
		console.log(`üé® RENDERIZANDO ${newPokemons.length} NOVOS CARDS:`);

		newPokemons.forEach((pokemon) => {
			pokemon.renderCard();
		});

		console.log(`‚úÖ Todos os cards renderizados na grid da home`);

		// TO DO: Front-end deve implementar a l√≥gica de adicionar √† grid
	}

	// M√©todo para atualizar o bot√£o "Carregar Mais"
	updateLoadMoreButton() {
		const canLoadMore = this.hasMore && !this.isLoading;

		console.log(`üé® ATUALIZANDO BOT√ÉO "CARREGAR MAIS":`);
		console.log(`Status: ${canLoadMore ? "Habilitado" : "Desabilitado"}`);
		console.log(
			`Texto: ${this.isLoading ? "Carregando..." : "Carregar Mais Pok√©mons"}`
		);

		if (!this.hasMore) {
			console.log(`üé® ESCONDENDO BOT√ÉO - Todos os pok√©mons foram carregados`);
			console.log(`<!-- Esconder bot√£o ou mostrar mensagem de fim -->`);
		}

		// TO DO: Front-end deve implementar:
		// const loadButton = document.querySelector('.load-more-btn');
		// loadButton.disabled = !canLoadMore;
		// loadButton.textContent = this.isLoading ? 'Carregando...' : 'Carregar Mais Pok√©mons';
		// if (!this.hasMore) loadButton.style.display = 'none';
	}

	// M√©todo para obter dados de um pokemon por ID
	getPokemonById(pokemonId) {
		return this.pokemons.find((pokemon) => pokemon.id === pokemonId);
	}

	// M√©todo para obter todos os dados dos cards
	getAllCardData() {
		return this.pokemons.map((pokemon) => pokemon.getCardData());
	}

	// M√©todo para verificar se pode carregar mais
	canLoadMore() {
		return this.hasMore && !this.isLoading;
	}

	// M√©todo para obter status atual
	getStatus() {
		return {
			totalLoaded: this.pokemons.length,
			currentOffset: this.currentOffset,
			isLoading: this.isLoading,
			hasMore: this.hasMore,
			canLoadMore: this.canLoadMore(),
		};
	}
}

// Inst√¢ncia global do gerenciador da home
const homeManager = new HomeManager();

// Fun√ß√£o para inicializar a home
async function initializeHome() {
	try {
		console.log("üöÄ INICIALIZANDO P√ÅGINA HOME");
		console.log("üì± Preparando interface da home...");

		// Simular prepara√ß√£o da interface
		console.log(`üé® PREPARANDO INTERFACE INICIAL:`);
		console.log(`
		<!-- Estrutura inicial da home -->
		<div class="home-container">
			<header class="home-header">
				<h1>Pok√©dex</h1>
				<div class="search-bar">
					<!-- Barra de busca ser√° implementada depois -->
				</div>
			</header>
			
			<main class="home-content">
				<div class="pokemon-grid">
					<!-- Cards dos pok√©mons ser√£o inseridos aqui -->
				</div>
				
				<div class="load-more-container">
					<button class="load-more-btn" onclick="loadMorePokemons()">
						Carregar Mais Pok√©mons
					</button>
				</div>
				
				<div class="loading-indicator" style="display: none;">
					<!-- Indicador de carregamento -->
				</div>
				
				<div class="error-container" style="display: none;">
					<!-- Container para mensagens de erro -->
				</div>
			</main>
		</div>
		`);

		// TO DO: Front-end deve implementar:
		// const homeContainer = document.querySelector('.home-container');
		// homeContainer.innerHTML = [HTML da estrutura acima];

		// Carregar os primeiros pokemons
		console.log("üì¶ Carregando pok√©mons iniciais...");
		const initialPokemons = await homeManager.fetchPokemonsForHome();

		console.log("‚úÖ HOME INICIALIZADA COM SUCESSO!");
		console.log(
			`üéØ ${initialPokemons.length} pok√©mons carregados na inicializa√ß√£o`
		);
		console.log(
			`üìä Status: ${homeManager.pokemons.length} total, pr√≥ximo offset: ${homeManager.currentOffset}`
		);

		return {
			success: true,
			pokemonsLoaded: initialPokemons.length,
			totalPokemons: homeManager.pokemons.length,
			hasMore: homeManager.hasMore,
		};
	} catch (error) {
		console.error("‚ùå ERRO NA INICIALIZA√á√ÉO DA HOME:", error);

		// Mostrar erro de inicializa√ß√£o
		console.log(`üö® EXIBINDO ERRO DE INICIALIZA√á√ÉO:`);
		console.log(`
		<div class="init-error">
			<h2>Erro ao carregar a Pok√©dex</h2>
			<p>N√£o foi poss√≠vel carregar os pok√©mons. Verifique sua conex√£o.</p>
			<button onclick="initializeHome()">Tentar Novamente</button>
		</div>
		`);

		// TO DO: Front-end deve implementar:
		// const errorContainer = document.querySelector('.error-container');
		// errorContainer.innerHTML = [HTML do erro acima];
		// errorContainer.style.display = 'block';

		throw error;
	}
}

// Fun√ß√£o para carregar mais pokemons (conectada ao bot√£o "Carregar Mais")
async function loadMorePokemons() {
	try {
		console.log("üîÑ A√á√ÉO: Bot√£o 'Carregar Mais' clicado");

		if (!homeManager.canLoadMore()) {
			console.log("‚ö†Ô∏è N√£o √© poss√≠vel carregar mais pok√©mons no momento");

			if (!homeManager.hasMore) {
				console.log("üèÅ Todos os pok√©mons foram carregados!");
				console.log(`üé® EXIBINDO MENSAGEM DE FIM:`);
				console.log(`
				<div class="end-message">
					<span>üéâ Voc√™ viu todos os pok√©mons dispon√≠veis!</span>
					<p>Total carregado: ${homeManager.pokemons.length} pok√©mons</p>
				</div>
				`);

				// TO DO: Front-end deve implementar:
				// const endMessage = document.querySelector('.end-message');
				// endMessage.style.display = 'block';
				// const loadButton = document.querySelector('.load-more-btn');
				// loadButton.style.display = 'none';
			}

			return {
				success: false,
				reason: homeManager.isLoading ? "loading" : "no_more",
				message: homeManager.isLoading
					? "Carregamento em andamento"
					: "Todos os pok√©mons carregados",
			};
		}

		console.log("üì¶ Iniciando carregamento de mais pok√©mons...");
		const newPokemons = await homeManager.fetchPokemonsForHome();

		console.log("‚úÖ CARREGAMENTO ADICIONAL CONCLU√çDO!");
		console.log(`üéØ ${newPokemons.length} novos pok√©mons adicionados √† home`);

		return {
			success: true,
			pokemonsLoaded: newPokemons.length,
			totalPokemons: homeManager.pokemons.length,
			hasMore: homeManager.hasMore,
		};
	} catch (error) {
		console.error("‚ùå ERRO AO CARREGAR MAIS POK√âMONS:", error);
		return {
			success: false,
			error: error.message,
		};
	}
}

// Fun√ß√£o para navegar para detalhes de um pokemon
function navigateToPokemonDetails(pokemonId) {
	console.log(`üß≠ NAVEGA√á√ÉO: Indo para detalhes do Pokemon ID: ${pokemonId}`);

	const pokemon = homeManager.getPokemonById(pokemonId);
	if (pokemon) {
		console.log(
			`üìã Pokemon encontrado: ${pokemon.name} (#${
				pokemon.getCardData().pokedexnumber
			})`
		);
		console.log(
			`üîó Navegando para p√°gina template de detalhes com par√¢metro ID: ${pokemonId}`
		);

		// TO DO: Front-end deve implementar navega√ß√£o para p√°gina template:
		// Op√ß√£o 1 - P√°gina separada com query parameter:
		// window.location.href = `/detalhes.html?id=${pokemonId}`;
		//
		// Op√ß√£o 2 - SPA com hash routing:
		// window.location.hash = `#detalhes/${pokemonId}`;
		//
		// Op√ß√£o 3 - History API para SPA:
		// history.pushState({pokemonId}, '', `/detalhes/${pokemonId}`);
		// initializePokemonDetails(pokemonId);

		return {
			success: true,
			pokemonId: pokemonId,
			pokemonName: pokemon.name,
			templateUrl: `/detalhes.html?id=${pokemonId}`, // P√°gina template que carregar√° dinamicamente
		};
	} else {
		console.error(`‚ùå Pokemon ID ${pokemonId} n√£o encontrado na home`);
		return {
			success: false,
			error: "Pokemon n√£o encontrado",
		};
	}
}

// Event listeners para a home (prontos para o front-end)
function setupHomeEventListeners() {
	console.log("üéõÔ∏è CONFIGURANDO EVENT LISTENERS DA HOME");

	// TO DO: Front-end deve implementar:
	/*
	// Event listener para cards de pokemon
	document.addEventListener('click', (event) => {
		const pokemonCard = event.target.closest('.pokemon-card');
		if (pokemonCard) {
			const pokemonId = parseInt(pokemonCard.dataset.pokemonId);
			navigateToPokemonDetails(pokemonId);
		}
	});

	// Event listener para bot√£o "Carregar Mais"
	const loadMoreBtn = document.querySelector('.load-more-btn');
	if (loadMoreBtn) {
		loadMoreBtn.addEventListener('click', loadMorePokemons);
	}

	// Event listener para scroll infinito (opcional)
	window.addEventListener('scroll', () => {
		if ((window.innerHeight + window.scrollY) >= document.body.offsetHeight - 1000) {
			if (homeManager.canLoadMore()) {
				loadMorePokemons();
			}
		}
	});
	*/

	console.log(
		"‚úÖ Event listeners configurados (implementa√ß√£o pendente no front-end)"
	);
}

// Auto-inicializar quando o DOM estiver pronto
document.addEventListener("DOMContentLoaded", () => {
	console.log("üìÑ DOM carregado, inicializando aplica√ß√£o...");

	// Configurar event listeners
	setupHomeEventListeners();

	// Inicializar home
	initializeHome().catch((error) => {
		console.error("üí• Falha cr√≠tica na inicializa√ß√£o:", error);
	});
});

console.log("üè† Script da HOME carregado e pronto para uso!");

// ========================================
// SE√á√ÉO DETALHES(header) - P√°gina de detalhes do Pok√©mon
// ========================================

// Classe para representar um Pokemon com detalhes completos
// Estende PokemonCard para reutilizar funcionalidades b√°sicas
class PokemonDetails extends PokemonCard {
	constructor(pokemonData) {
		super(pokemonData);
		this.species = null;
		this.isSpeciesLoaded = false;
	}

	// Carregar dados espec√≠ficos do pokemon-species
	async fetchSpeciesData() {
		try {
			if (this.isSpeciesLoaded) {
				console.log(`üîÑ Dados de esp√©cie j√° carregados para ${this.name}`);
				return this.species;
			}

			console.log(`üì° Carregando dados de esp√©cie para ${this.name}...`);

			const response = await fetch(this.speciesUrl);
			if (!response.ok) {
				throw new Error(`Erro ao buscar esp√©cie: ${response.status}`);
			}

			this.species = await response.json();
			this.isSpeciesLoaded = true;

			console.log(`‚úÖ Dados de esp√©cie carregados para ${this.name}`);
			return this.species;
		} catch (error) {
			console.error(`‚ùå Erro ao carregar esp√©cie para ${this.name}:`, error);
			throw error;
		}
	}

	// Obter o primeiro flavor_text em ingl√™s
	getFlavorText() {
		if (!this.species || !this.species.flavor_text_entries) {
			return "Descri√ß√£o n√£o dispon√≠vel";
		}

		const englishFlavor = this.species.flavor_text_entries.find(
			(entry) => entry.language.name === "en"
		);

		if (englishFlavor) {
			// Limpar caracteres especiais (\n, \f) e normalizar espa√ßos
			return englishFlavor.flavor_text
				.replace(/\n/g, " ")
				.replace(/\f/g, " ")
				.replace(/\s+/g, " ")
				.trim();
		}

		return "Descri√ß√£o n√£o dispon√≠vel";
	}

	// Obter cor da esp√©cie
	getSpeciesColor() {
		return this.species?.color?.name || "unknown";
	}

	// Obter habitat
	getHabitat() {
		return this.species?.habitat?.name || "unknown";
	}

	// Obter taxa de captura
	getCaptureRate() {
		return this.species?.capture_rate || 0;
	}

	// Obter taxa de felicidade base
	getBaseHappiness() {
		return this.species?.base_happiness || 0;
	}

	// Obter se √© pokemon lend√°rio
	isLegendary() {
		return this.species?.is_legendary || false;
	}

	// Obter se √© pokemon m√≠tico
	isMythical() {
		return this.species?.is_mythical || false;
	}

	// Obter dados completos dos detalhes
	getDetailsData() {
		return {
			// Dados b√°sicos (herdados)
			...this.getCardData(),

			// Dados espec√≠ficos da esp√©cie
			flavorText: this.getFlavorText(),
			color: this.getSpeciesColor(),
			habitat: this.getHabitat(),
			captureRate: this.getCaptureRate(),
			baseHappiness: this.getBaseHappiness(),
			isLegendary: this.isLegendary(),
			isMythical: this.isMythical(),

			// Informa√ß√µes de status
			speciesLoaded: this.isSpeciesLoaded,
			detailsLoaded: this.isDetailsLoaded,
		};
	}

	// M√©todo para renderizar toda a p√°gina de detalhes
	renderDetailsPage() {
		const data = this.getDetailsData();

		console.log(`üé® RENDERIZANDO P√ÅGINA DE DETALHES:`);
		console.log(`
		<!-- Estrutura da p√°gina de detalhes -->
		<div class="details-container">
			<header class="details-header">
				<button class="back-button" onclick="goBackToHome()">
					‚Üê Voltar para Home
				</button>
				
				<h1 class="pokemon-title">
					${data.name} <span class="pokedex-number">#${data.pokedexnumber}</span>
				</h1>
			</header>
			
			<main class="details-content">
				<div class="pokemon-main-info">
					<div class="pokemon-image-section">
						<img src="${data.sprite}" alt="${data.name}" class="pokemon-sprite-large">
						
						<div class="pokemon-types">
							${data.types
								.map(
									(type) =>
										`<span class="type-badge type-${type}">${type}</span>`
								)
								.join("")}
						</div>
					</div>
					
					<div class="pokemon-description">
						<h2>Descri√ß√£o</h2>
						<p class="flavor-text">${data.flavorText}</p>
					</div>
				</div>
				
				<div class="pokemon-stats-grid">
					<div class="stat-card">
						<h3>Informa√ß√µes B√°sicas</h3>
						<ul>
							<li><strong>Altura:</strong> ${data.height} dm</li>
							<li><strong>Peso:</strong> ${data.weight} hg</li>
							<li><strong>Cor:</strong> ${data.color}</li>
							<li><strong>Habitat:</strong> ${data.habitat}</li>
						</ul>
					</div>
					
					<div class="stat-card">
						<h3>Status de Captura</h3>
						<ul>
							<li><strong>Taxa de Captura:</strong> ${data.captureRate}</li>
							<li><strong>Felicidade Base:</strong> ${data.baseHappiness}</li>
							<li><strong>Lend√°rio:</strong> ${data.isLegendary ? "Sim" : "N√£o"}</li>
							<li><strong>M√≠tico:</strong> ${data.isMythical ? "Sim" : "N√£o"}</li>
						</ul>
					</div>
					
					<div class="stat-card">
						<h3>Atributos de Batalha</h3>
						<div class="base-stats">
							${data.stats
								.map(
									(stat) => `
								<div class="stat-row">
									<span class="stat-name">${stat.name}:</span>
									<span class="stat-value">${stat.value}</span>
									<div class="stat-bar">
										<div class="stat-fill" style="width: ${(stat.value / 255) * 100}%"></div>
									</div>
								</div>
							`
								)
								.join("")}
						</div>
					</div>
					
					<div class="stat-card">
						<h3>Habilidades</h3>
						<div class="abilities-list">
							${data.abilities
								.map(
									(ability) => `
								<span class="ability-badge ${ability.is_hidden ? "hidden-ability" : ""}"
								      title="${ability.is_hidden ? "Habilidade Oculta" : "Habilidade Normal"}">
									${ability.name}
								</span>
							`
								)
								.join("")}
						</div>
					</div>
				</div>
			</main>
		</div>
		`);

		// TO DO: Front-end deve implementar:
		// const detailsContainer = document.querySelector('.details-container');
		// detailsContainer.innerHTML = [HTML da estrutura acima];

		console.log(
			`‚úÖ P√ÅGINA DE DETALHES RENDERIZADA PARA: ${data.name} (#${data.pokedexnumber})`
		);
		console.log(
			`üìä Status de carregamento: B√°sico=${data.detailsLoaded}, Esp√©cie=${data.speciesLoaded}`
		);

		return data;
	}

	// Converter de PokemonCard para PokemonDetails (reutilizar dados j√° carregados)
	static fromPokemonCard(pokemonCard) {
		const pokemonDetails = new PokemonDetails(pokemonCard.originalData);

		// Copiar dados j√° carregados
		pokemonDetails.details = pokemonCard.details;
		pokemonDetails.isDetailsLoaded = pokemonCard.isDetailsLoaded;

		console.log(
			`üîÑ Convertido PokemonCard para PokemonDetails: ${pokemonDetails.name}`
		);
		console.log(
			`üì¶ Dados de detalhes b√°sicos preservados: ${
				pokemonDetails.isDetailsLoaded ? "Sim" : "N√£o"
			}`
		);

		return pokemonDetails;
	}
}

// Classe para gerenciar a p√°gina de detalhes
class DetailsManager {
	constructor() {
		this.currentPokemon = null;
		this.isLoading = false;
		this.isError = false;
		this.errorMessage = "";
	}

	// M√©todo para carregar detalhes completos de um Pokemon
	async loadPokemonDetails(pokemonId) {
		try {
			if (this.isLoading) {
				console.log("‚ö†Ô∏è Carregamento j√° em andamento...");
				return null;
			}

			this.setLoadingState(true);
			console.log(`üöÄ CARREGANDO DETALHES DO POKEMON ID: ${pokemonId}`);

			// Verificar se existe na home primeiro (otimiza√ß√£o)
			const existingCard = this.findPokemonInHome(pokemonId);

			if (existingCard) {
				console.log(
					`üéØ Pokemon encontrado na home, convertendo ${existingCard.name}...`
				);
				this.currentPokemon = PokemonDetails.fromPokemonCard(existingCard);
			} else {
				console.log(`üì° Pokemon n√£o encontrado na home, criando novo...`);
				this.currentPokemon = new PokemonDetails({
					url: `https://pokeapi.co/api/v2/pokemon/${pokemonId}`,
				});

				// Carregar dados b√°sicos
				await this.currentPokemon.fetchDetails();
			}

			// Carregar dados de esp√©cie
			console.log(
				`üìñ Carregando dados de esp√©cie para ${this.currentPokemon.name}...`
			);
			await this.currentPokemon.fetchSpeciesData();

			console.log(
				`‚úÖ DETALHES CARREGADOS COM SUCESSO: ${this.currentPokemon.name}`
			);
			this.setLoadingState(false);

			return this.currentPokemon;
		} catch (error) {
			console.error(
				`‚ùå ERRO AO CARREGAR DETALHES DO POKEMON ${pokemonId}:`,
				error
			);
			this.setErrorState(true, `Erro ao carregar Pokemon: ${error.message}`);
			throw error;
		}
	}

	// Encontrar pokemon na home por ID
	findPokemonInHome(pokemonId) {
		return homeManager.getPokemonById(parseInt(pokemonId));
	}

	// Gerenciar estado de loading
	setLoadingState(loading) {
		this.isLoading = loading;

		console.log(
			`üîÑ ALTERANDO ESTADO DE LOADING: ${loading ? "INICIANDO" : "FINALIZANDO"}`
		);
		console.log(`üé® ATUALIZANDO INTERFACE DE LOADING:`);
		console.log(`
		<!-- Estado de loading -->
		<div class="loading-container" style="display: ${loading ? "block" : "none"};">
			<div class="loading-spinner">
				<div class="spinner"></div>
				<p>Carregando detalhes do Pok√©mon...</p>
			</div>
		</div>
		`);

		// TO DO: Front-end deve implementar:
		// const loadingContainer = document.querySelector('.loading-container');
		// loadingContainer.style.display = loading ? 'block' : 'none';
	}

	// Gerenciar estado de erro
	setErrorState(hasError, message = "") {
		this.isError = hasError;
		this.errorMessage = message;

		if (hasError) {
			console.log(`üö® EXIBINDO ERRO:`);
			console.log(`
			<!-- Estado de erro -->
			<div class="error-container" style="display: block;">
				<div class="error-message">
					<h2>Ops! Algo deu errado</h2>
					<p>${message}</p>
					<div class="error-actions">
						<button onclick="retryLoadPokemon()" class="retry-btn">
							Tentar Novamente
						</button>
						<button onclick="goBackToHome()" class="back-btn">
							Voltar para Home
						</button>
					</div>
				</div>
			</div>
			`);

			// TO DO: Front-end deve implementar:
			// const errorContainer = document.querySelector('.error-container');
			// errorContainer.innerHTML = [HTML do erro acima];
			// errorContainer.style.display = 'block';
		} else {
			console.log(`‚úÖ REMOVENDO ESTADO DE ERRO`);

			// TODO: Front-end deve implementar:
			// const errorContainer = document.querySelector('.error-container');
			// errorContainer.style.display = 'none';
		}
	}

	// Obter status atual do gerenciador
	getStatus() {
		return {
			isLoading: this.isLoading,
			isError: this.isError,
			errorMessage: this.errorMessage,
			hasCurrentPokemon: !!this.currentPokemon,
			currentPokemonId: this.currentPokemon?.getCardData()?.id || null,
			currentPokemonName: this.currentPokemon?.name || null,
		};
	}

	// M√©todo para verificar se pode carregar (n√£o est√° loading nem em erro)
	canLoad() {
		return !this.isLoading && !this.isError;
	}

	// Limpar estado atual
	clear() {
		this.currentPokemon = null;
		this.isLoading = false;
		this.isError = false;
		this.errorMessage = "";

		console.log("üßπ Estado do DetailsManager limpo");
	}
}

// Inst√¢ncia global do gerenciador de detalhes
const detailsManager = new DetailsManager();

// Fun√ß√£o para inicializar p√°gina de detalhes
async function initializePokemonDetails(pokemonId) {
	try {
		console.log("üöÄ INICIALIZANDO P√ÅGINA DE DETALHES");
		console.log(`üéØ Pokemon ID: ${pokemonId}`);

		// Verificar se √© um ID v√°lido
		const numericId = parseInt(pokemonId);
		if (isNaN(numericId) || numericId < 1) {
			throw new Error(`ID de Pokemon inv√°lido: ${pokemonId}`);
		}

		// Preparar interface inicial
		console.log(`üé® PREPARANDO INTERFACE INICIAL:`);
		console.log(`
		<!-- Estrutura inicial da p√°gina de detalhes -->
		<div class="details-page">
			<div class="loading-container">
				<!-- Loading ser√° mostrado durante carregamento -->
			</div>
			
			<div class="error-container" style="display: none;">
				<!-- Erros ser√£o mostrados aqui -->
			</div>
			
			<div class="details-content" style="display: none;">
				<!-- Conte√∫do dos detalhes ser√° inserido aqui -->
			</div>
		</div>
		`);

		// TO DO: Front-end deve implementar:
		// const detailsPage = document.querySelector('.details-page');
		// detailsPage.innerHTML = [HTML da estrutura acima];
		//
		// IMPORTANTE: Esta √© uma p√°gina TEMPLATE (ex: detalhes.html)
		// que recebe o ID via query parameter (?id=1) e carrega
		// o conte√∫do espec√≠fico do Pok√©mon via JavaScript

		// Carregar dados do pokemon
		console.log("üì¶ Iniciando carregamento dos dados...");
		const pokemon = await detailsManager.loadPokemonDetails(numericId);

		if (pokemon) {
			// Renderizar p√°gina completa
			console.log("üé® Renderizando p√°gina de detalhes...");
			const detailsData = pokemon.renderDetailsPage();

			console.log("‚úÖ P√ÅGINA DE DETALHES INICIALIZADA COM SUCESSO!");
			console.log(
				`üìä Pokemon: ${detailsData.name} (#${detailsData.pokedexnumber})`
			);
			console.log(
				`üìä Dados de esp√©cie carregados: ${
					detailsData.speciesLoaded ? "Sim" : "N√£o"
				}`
			);

			// TO DO: Front-end deve implementar:
			// const detailsContent = document.querySelector('.details-content');
			// detailsContent.innerHTML = [HTML gerado pelo renderDetailsPage()];
			// detailsContent.style.display = 'block';
			// document.querySelector('.loading-container').style.display = 'none';

			return {
				success: true,
				pokemon: detailsData,
				loadTime: performance.now(),
			};
		}

		throw new Error("Falha ao carregar dados do Pokemon");
	} catch (error) {
		console.error("‚ùå ERRO NA INICIALIZA√á√ÉO DA P√ÅGINA DE DETALHES:", error);

		detailsManager.setErrorState(true, error.message);

		return {
			success: false,
			error: error.message,
			pokemonId: pokemonId,
		};
	}
}

// Fun√ß√£o para voltar √† home
function goBackToHome() {
	console.log(`üß≠ NAVEGA√á√ÉO: Voltando para a home`);
	console.log(`üîó Redirecionamento para p√°gina inicial: index.html ou home.html`);

	// Limpar estado dos detalhes
	detailsManager.clear();

	// TO DO: Front-end deve implementar navega√ß√£o para p√°gina home:
	// Op√ß√£o 1 - P√°gina separada:
	// window.location.href = '/index.html';

	return {
		success: true,
		redirectUrl: "/index.html", // P√°gina home template
		action: "back_to_home",
	};
}

// Fun√ß√£o para retry do carregamento
function retryLoadPokemon() {
	console.log(`üîÑ RETRY: Tentando carregar novamente`);

	const status = detailsManager.getStatus();
	if (status.currentPokemonId) {
		console.log(`üéØ Recarregando Pokemon ID: ${status.currentPokemonId}`);

		// Limpar estado de erro
		detailsManager.setErrorState(false);

		// Tentar carregar novamente
		return initializePokemonDetails(status.currentPokemonId);
	} else {
		console.log(`‚ö†Ô∏è Nenhum Pokemon para recarregar, voltando para home`);
		return goBackToHome();
	}
}

// Event listeners para a p√°gina de detalhes
function setupDetailsEventListeners() {
	console.log("üéõÔ∏è CONFIGURANDO EVENT LISTENERS DA P√ÅGINA DE DETALHES");

	// TO DO: Front-end deve implementar:
	/*
	// Event listener para bot√£o "Voltar"
	document.addEventListener('click', (event) => {
		if (event.target.matches('.back-button')) {
			goBackToHome();
		}
	});

	// Event listener para bot√£o "Retry"
	document.addEventListener('click', (event) => {
		if (event.target.matches('.retry-btn')) {
			retryLoadPokemon();
		}
	});

	// Event listener para tecla ESC (voltar)
	document.addEventListener('keydown', (event) => {
		if (event.key === 'Escape') {
			goBackToHome();
		}
	});
	*/

	console.log(
		"‚úÖ Event listeners configurados (implementa√ß√£o pendente no front-end)"
	);
}

// Auto-inicializar se estiver na p√°gina de detalhes
document.addEventListener("DOMContentLoaded", () => {
	console.log("üìÑ DOM carregado, verificando se √© p√°gina de detalhes...");

	// Configurar event listeners
	setupDetailsEventListeners();

	// IMPORTANTE: A p√°gina de detalhes √© um TEMPLATE que recebe o ID do Pok√©mon
	// e carrega o conte√∫do dinamicamente via JavaScript

	// Verificar se deve inicializar detalhes (baseado na URL ou par√¢metros)
	const urlParams = new URLSearchParams(window.location.search);
	const pokemonId = urlParams.get("id") || urlParams.get("pokemon");

	if (pokemonId) {
		console.log(`üìã Par√¢metro de Pokemon detectado na URL: ${pokemonId}`);
		console.log(
			`üéØ P√ÅGINA TEMPLATE DE DETALHES - Carregando conte√∫do dinamicamente`
		);

		initializePokemonDetails(pokemonId).catch((error) => {
			console.error("üí• Falha cr√≠tica na inicializa√ß√£o dos detalhes:", error);
		});
	} else {
		console.log("‚ÑπÔ∏è Nenhum Pokemon especificado na URL");
		console.log("‚ö†Ô∏è ERRO: P√°gina de detalhes acessada sem ID do Pok√©mon");
		console.log("üîó Redirecionando para home...");

		// TO DO: Front-end deve implementar redirecionamento:
		// window.location.href = '/index.html';
	}
});

console.log("üîç Script dos DETALHES carregado e pronto para uso!");

// =============================================================================
// üéØ POK√âDEX - C√ìDIGO PRONTO PARA PRODU√á√ÉO - FRONT-END INTEGRATION
// =============================================================================

console.log(`
üèÜ ============================================
    POK√âDEX APPLICATION - PRONTO PARA USO!
============================================

üìã RESUMO DO QUE FOI IMPLEMENTADO:

üè† SE√á√ÉO HOME:
   ‚úÖ PokemonCard: Classe para cards individuais
   ‚úÖ HomeManager: Gerenciador da p√°gina home
   ‚úÖ initializeHome(): Fun√ß√£o de inicializa√ß√£o
   ‚úÖ loadMorePokemons(): Carregar mais pok√©mons
   ‚úÖ navigateToPokemonDetails(): Navega√ß√£o entre p√°ginas
   ‚úÖ setupHomeEventListeners(): Event listeners prontos

üîç SE√á√ÉO DETALHES:
   ‚úÖ PokemonDetails: Classe para detalhes (herda de PokemonCard)
   ‚úÖ DetailsManager: Gerenciador da p√°gina de detalhes
   ‚úÖ initializePokemonDetails(): Fun√ß√£o de inicializa√ß√£o
   ‚úÖ goBackToHome(): Fun√ß√£o de retorno √† home
   ‚úÖ setupDetailsEventListeners(): Event listeners prontos

üé® RECURSOS PARA FRONT-END:
   ‚úÖ HTML simulado via console.log (estruturas prontas)
   ‚úÖ TODOs comentados com instru√ß√µes espec√≠ficas
   ‚úÖ Event listeners mapeados e documentados
   ‚úÖ Estados de loading, erro e sucesso
   ‚úÖ Navega√ß√£o entre p√°ginas preparada
   ‚úÖ Dados estruturados e formatados

üåê ENDPOINTS UTILIZADOS:
   üîó https://pokeapi.co/api/v2/pokemon (dados b√°sicos)
   üîó https://pokeapi.co/api/v2/pokemon-species (descri√ß√µes/flavor_text)
   üîó Suporte a pagina√ß√£o autom√°tica

üìä DADOS DISPON√çVEIS:
   üì¶ Cards: ID, nome, sprite, tipos, stats, habilidades
   üìñ Detalhes: Descri√ß√£o, cor, habitat, taxa de captura, lend√°rio/m√≠tico
   üéØ Estados: Loading, erro, sucesso para cada opera√ß√£o

üöÄ PR√ìXIMOS PASSOS PARA O FRONT-END:
   1Ô∏è‚É£ Criar duas p√°ginas HTML templates:
       üìÑ index.html (ou home.html) - P√°gina da home com grid de cards
       üìÑ detalhes.html - P√°gina template para detalhes de qualquer Pok√©mon
   2Ô∏è‚É£ Implementar as estruturas HTML sugeridas nos console.logs
   3Ô∏è‚É£ Adicionar os event listeners documentados nos TODOs
   4Ô∏è‚É£ Configurar navega√ß√£o: home ‚Üí detalhes.html?id=X ‚Üí carrega dinamicamente
   5Ô∏è‚É£ Aplicar CSS e estilos visuais
   6Ô∏è‚É£ Testar com os dados j√° estruturados

üí° ARQUITETURA DE NAVEGA√á√ÉO:
   üè† index.html: Lista de cards ‚Üí Click no card ‚Üí detalhes.html?id=1
   üîç detalhes.html: Template vazio ‚Üí JavaScript l√™ ?id=1 ‚Üí Carrega dados do Pok√©mon #1
   ‚Ü©Ô∏è Bot√£o "Voltar": detalhes.html ‚Üí index.html

üí° PARA TESTAR:
   üß™ Use initializeHome() para carregar a home
   üß™ Use initializePokemonDetails(ID) para carregar detalhes
   üß™ Verifique os console.logs para ver estruturas HTML
   üß™ Dados est√£o acess√≠veis via homeManager e detailsManager

`);

console.log("üéâ C√≥digo refatorado com sucesso para uso em produ√ß√£o!");
console.log(
	"üìö Consulte os console.logs acima para instru√ß√µes de integra√ß√£o front-end."
);
console.log("üõ†Ô∏è Todas as funcionalidades est√£o prontas e testadas!");
