<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Pokédex - Details</title>

		<!-- Bootstrap 5 CSS -->
		<link
			href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
			rel="stylesheet"
		/>

		<!-- Bootstrap Icons -->
		<link
			href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.css"
			rel="stylesheet"
		/>

		<!-- Custom CSS -->
		<link href="style.css" rel="stylesheet" />
	</head>
	<body class="bg-light">
		<!-- Main Content -->
		<main class="container-fluid px-0">
			<!-- Loading State -->
			<div class="text-center py-5" id="loading-state">
				<div
					class="spinner-border text-primary mb-3"
					style="width: 3rem; height: 3rem"
					role="status"
				>
					<span class="visually-hidden">Loading...</span>
				</div>
				<h4 class="text-muted">Loading Pokémon details...</h4>
			</div>

			<!-- Error State -->
			<div
				class="alert alert-danger rounded-4 text-center mx-auto"
				style="max-width: 600px; display: none"
				id="error-state"
			>
				<i class="bi bi-exclamation-triangle-fill fs-1 mb-3"></i>
				<h4>Error loading Pokémon</h4>
				<p class="mb-3">Could not load the requested Pokémon details.</p>
				<div class="d-flex gap-2 justify-content-center flex-wrap">
					<button
						class="btn btn-danger rounded-pill px-3"
						onclick="location.reload()"
					>
						<i class="bi bi-arrow-clockwise me-2"></i>Try Again
					</button>
					<a href="index.html" class="btn btn-secondary rounded-pill px-3">
						<i class="bi bi-house-fill me-2"></i>Back to Home
					</a>
				</div>
			</div>

			<!-- Pokemon Details (hidden initially) -->
			<div id="pokemon-details" style="display: none">
				<!-- SECTION 1: Header and Sprite -->
				<div class="position-relative overflow-hidden">
					<!-- Type Background -->
					<div
						id="pokemon-background"
						class="position-absolute w-100 h-100"
						style="z-index: 1"
					></div>

					<!-- Header Navigation -->
					<div class="position-relative" style="z-index: 3">
						<div class="container-fluid px-4 py-3">
							<div class="row align-items-center">
								<!-- Back Button + Pokemon Name -->
								<div class="col-8 d-flex align-items-center">
									<a
										href="index.html"
										class="text-white me-3"
										style="font-size: 2rem"
										title="Back to Home"
									>
										<i class="bi bi-arrow-left"></i>
									</a>
									<h1
										class="mb-0 text-white fw-bold text-capitalize"
										id="pokemon-name"
									>
										Loading...
									</h1>
								</div>

								<!-- Pokedex Number -->
								<div class="col-4 text-end">
									<span
										class="badge bg-dark bg-opacity-75 text-white fs-5 px-3 py-2 rounded-pill shadow"
										id="pokemon-id-badge"
									>
										#000
									</span>
								</div>
							</div>
						</div>
					</div>

					<!-- Sprite Section -->
					<div class="position-relative py-4" style="z-index: 2">
						<div class="container-fluid px-4">
							<div class="row align-items-center">
								<!-- Previous Pokemon Button -->
								<div class="col-2 text-start">
									<button
										class="btn btn-light rounded-circle shadow"
										id="prev-pokemon-btn"
										style="
											width: 56px;
											height: 56px;
											opacity: 0.8;
											border: 2px solid rgba(255, 255, 255, 0.3);
											backdrop-filter: blur(10px);
										"
										title="Previous Pokémon"
									>
										<i class="bi bi-chevron-left fs-4"></i>
									</button>
								</div>

								<!-- Main Sprite -->
								<div class="col-8 text-center">
									<div class="position-relative d-inline-block">
										<!-- Audio Indicator -->
										<div
											id="audio-indicator"
											class="position-absolute top-0 end-0 bg-primary text-white rounded-circle d-flex align-items-center justify-content-center"
											style="
												width: 40px;
												height: 40px;
												z-index: 3;
												display: none;
												transform: translate(50%, -50%);
											"
										>
											<i class="bi bi-volume-up-fill"></i>
										</div>

										<img
											id="pokemon-main-sprite"
											src=""
											alt=""
											class="position-relative img-fluid"
											style="
												width: 200px;
												height: 200px;
												object-fit: contain;
												z-index: 2;
												filter: drop-shadow(
													0 8px 16px rgba(0, 0, 0, 0.3)
												);
												cursor: pointer;
											"
											title="Clique para ouvir o som do Pokémon"
										/>
									</div>
								</div>

								<!-- Next Pokemon Button -->
								<div class="col-2 text-end">
									<button
										class="btn btn-light rounded-circle shadow"
										id="next-pokemon-btn"
										style="
											width: 56px;
											height: 56px;
											opacity: 0.8;
											border: 2px solid rgba(255, 255, 255, 0.3);
											backdrop-filter: blur(10px);
										"
										title="Next Pokémon"
									>
										<i class="bi bi-chevron-right fs-4"></i>
									</button>
								</div>
							</div>

							<!-- Types -->
							<div class="row mt-3">
								<div class="col-12 text-center">
									<div
										id="pokemon-types"
										class="d-flex justify-content-center gap-2 flex-wrap"
									>
										<!-- Types will be inserted here -->
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>

				<!-- SECTION 2: Basic Information -->
				<div class="bg-white">
					<div class="container-fluid px-4 py-4">
						<div class="row">
							<div class="col-12">
								<div class="card border-0 shadow-sm rounded-4">
									<div class="card-body p-4">
										<h2 class="card-title fw-bold mb-3">
											<i
												class="bi bi-info-circle-fill text-primary me-2"
											></i>
											Basic Information
										</h2>

										<!-- Description -->
										<div class="mb-4">
											<h5 class="fw-semibold text-muted mb-2">
												Description
											</h5>
											<p
												class="lead text-muted mb-0"
												id="pokemon-description"
											>
												Loading description...
											</p>
										</div>

										<div class="row">
											<!-- Stats Column -->
											<div class="col-md-6">
												<h5 class="fw-semibold text-muted mb-3">
													Physical Stats
												</h5>
												<ul
													class="list-unstyled"
													id="basic-info"
												>
													<li class="mb-2">
														<strong>Height:</strong>
														<span class="text-muted"
															>Loading...</span
														>
													</li>
													<li class="mb-2">
														<strong>Weight:</strong>
														<span class="text-muted"
															>Loading...</span
														>
													</li>
													<li class="mb-2">
														<strong>Color:</strong>
														<span class="text-muted"
															>Loading...</span
														>
													</li>
													<li class="mb-0">
														<strong>Habitat:</strong>
														<span class="text-muted"
															>Loading...</span
														>
													</li>
												</ul>
											</div>

											<!-- Abilities Column -->
											<div class="col-md-6">
												<h5 class="fw-semibold text-muted mb-3">
													Abilities
												</h5>
												<div
													id="abilities-list"
													class="d-flex flex-wrap gap-2"
												>
													<!-- Abilities will be inserted here -->
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>

				<!-- SECTION 3: Navigation Tabs -->
				<div class="bg-light">
					<div class="container-fluid px-4 py-4">
						<div class="row">
							<div class="col-12">
								<!-- Tab Navigation -->
								<div class="card border-0 shadow-sm rounded-4">
									<div
										class="card-header bg-white border-0 rounded-top-4 p-4"
									>
										<div
											class="btn-group w-100"
											role="group"
											aria-label="Pokemon details navigation"
										>
											<button
												type="button"
												class="btn btn-outline-primary active"
												id="stats-tab"
											>
												<i
													class="bi bi-bar-chart-fill me-2"
												></i>
												Stats
											</button>
											<button
												type="button"
												class="btn btn-outline-primary"
												id="evolution-tab"
											>
												<i class="bi bi-arrow-repeat me-2"></i>
												Evolution
											</button>
											<button
												type="button"
												class="btn btn-outline-primary"
												id="moves-tab"
											>
												<i
													class="bi bi-lightning-fill me-2"
												></i>
												Moves
											</button>
											<button
												type="button"
												class="btn btn-outline-primary"
												id="location-tab"
											>
												<i class="bi bi-geo-alt-fill me-2"></i>
												Location
											</button>
										</div>
									</div>

									<!-- Tab Content -->
									<div class="card-body p-4">
										<!-- Stats Tab Content (Active by default) -->
										<div
											id="stats-content"
											class="tab-content-section"
										>
											<h5 class="fw-semibold mb-3">Base Stats</h5>
											<div id="base-stats">
												<!-- Base stats will be inserted here -->
											</div>
										</div>

										<!-- Evolution Tab Content (Hidden by default) -->
										<div
											id="evolution-content"
											class="tab-content-section d-none"
										>
											<h5 class="fw-semibold mb-3">
												Evolution Chain
											</h5>
											<p class="text-muted">
												Evolution information will be displayed
												here.
											</p>
										</div>

										<!-- Moves Tab Content (Hidden by default) -->
										<div
											id="moves-content"
											class="tab-content-section d-none"
										>
											<h5 class="fw-semibold mb-3">
												Learnable Moves
											</h5>
											<div id="moves-list" class="row-3">
												<!-- Moves will be inserted here -->
											</div>
										</div>

										<!-- Location Tab Content (Hidden by default) -->
										<div
											id="location-content"
											class="tab-content-section d-none"
										>
											<h5 class="fw-semibold mb-3">Locations</h5>
											<p class="text-muted">
												Location information will be displayed
												here.
											</p>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</main>

		<!-- Bootstrap 5 JavaScript -->
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

		<!-- Main JavaScript (ES6 Module) -->
		<script type="module">
			// Import main functions
			import { initializePokemonDetails } from "./main.js";

			// Initialize when DOM is loaded
			document.addEventListener("DOMContentLoaded", async () => {
				try {
					// Get Pokemon ID from URL
					const urlParams = new URLSearchParams(window.location.search);
					const pokemonId = urlParams.get("id");

					if (!pokemonId) {
						throw new Error("Pokemon ID not found in URL");
					}

					// Initialize Pokemon details with the ID
					const result = await initializePokemonDetails(pokemonId);

					if (!result.success) {
						throw new Error(
							result.error || "Failed to load Pokemon details"
						);
					}

					console.log("✅ Pokemon details loaded successfully:", result);

					// Adicionar event listener para o áudio do sprite
					const sprite = document.getElementById("pokemon-main-sprite");
					if (sprite && result.pokemon) {
						sprite.addEventListener("click", async () => {
							try {
								await result.pokemon.playPokemonCry();
							} catch (error) {
								console.error("❌ Erro ao tocar áudio:", error);
							}
						});
					}
				} catch (error) {
					console.error("❌ Error loading Pokemon details:", error);

					// Show error state
					const loadingState = document.getElementById("loading-state");
					const errorState = document.getElementById("error-state");
					const pokemonDetails = document.getElementById("pokemon-details");

					if (loadingState) loadingState.style.display = "none";
					if (pokemonDetails) pokemonDetails.style.display = "none";
					if (errorState) {
						errorState.style.display = "block";
						const errorMessage = errorState.querySelector("p");
						if (errorMessage) {
							errorMessage.textContent = error.message;
						}
					}
				}

				// Tab navigation functionality
				const tabButtons = document.querySelectorAll(".btn-group button");
				const tabContents = document.querySelectorAll(".tab-content-section");

				tabButtons.forEach((button) => {
					button.addEventListener("click", () => {
						// Remove active class from all buttons
						tabButtons.forEach((btn) => btn.classList.remove("active"));
						// Add active class to clicked button
						button.classList.add("active");

						// Hide all tab contents
						tabContents.forEach((content) =>
							content.classList.add("d-none")
						);

						// Show corresponding content
						const targetId = button.id.replace("-tab", "-content");
						const targetContent = document.getElementById(targetId);
						if (targetContent) {
							targetContent.classList.remove("d-none");
						}
					});
				});
			});
		</script>
	</body>
</html>
